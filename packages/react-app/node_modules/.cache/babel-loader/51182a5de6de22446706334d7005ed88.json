{"ast":null,"code":"import { isJsonRpcRequest, isJsonRpcResponseSuccess, isJsonRpcResponseError, isInternalEvent, isReservedEvent } from \"@walletconnect/utils\";\n\nclass EventManager {\n  constructor() {\n    this._eventEmitters = [];\n  }\n\n  subscribe(eventEmitter) {\n    this._eventEmitters.push(eventEmitter);\n  }\n\n  unsubscribe(event) {\n    this._eventEmitters = this._eventEmitters.filter(x => x.event !== event);\n  }\n\n  trigger(payload) {\n    let eventEmitters = [];\n    let event;\n\n    if (isJsonRpcRequest(payload)) {\n      event = payload.method;\n    } else if (isJsonRpcResponseSuccess(payload) || isJsonRpcResponseError(payload)) {\n      event = `response:${payload.id}`;\n    } else if (isInternalEvent(payload)) {\n      event = payload.event;\n    } else {\n      event = \"\";\n    }\n\n    if (event) {\n      eventEmitters = this._eventEmitters.filter(eventEmitter => eventEmitter.event === event);\n    }\n\n    if ((!eventEmitters || !eventEmitters.length) && !isReservedEvent(event) && !isInternalEvent(event)) {\n      eventEmitters = this._eventEmitters.filter(eventEmitter => eventEmitter.event === \"call_request\");\n    }\n\n    eventEmitters.forEach(eventEmitter => {\n      if (isJsonRpcResponseError(payload)) {\n        const error = new Error(payload.error.message);\n        eventEmitter.callback(error, null);\n      } else {\n        eventEmitter.callback(null, payload);\n      }\n    });\n  }\n\n}\n\nexport default EventManager;","map":{"version":3,"sources":["../../src/events.ts"],"names":[],"mappings":"AAAA,SACE,gBADF,EAEE,wBAFF,EAGE,sBAHF,EAIE,eAJF,EAKE,eALF,QAMO,sBANP;;AAiBA,MAAM,YAAN,CAAkB;AAGhB,EAAA,WAAA,GAAA;AACE,SAAK,cAAL,GAAsB,EAAtB;AACD;;AAEM,EAAA,SAAS,CAAC,YAAD,EAA4B;AAC1C,SAAK,cAAL,CAAoB,IAApB,CAAyB,YAAzB;AACD;;AAEM,EAAA,WAAW,CAAC,KAAD,EAAc;AAC9B,SAAK,cAAL,GAAsB,KAAK,cAAL,CAAoB,MAApB,CAA2B,CAAC,IAAI,CAAC,CAAC,KAAF,KAAY,KAA5C,CAAtB;AACD;;AAEM,EAAA,OAAO,CACZ,OADY,EAC+E;AAE3F,QAAI,aAAa,GAAoB,EAArC;AACA,QAAI,KAAJ;;AAEA,QAAI,gBAAgB,CAAC,OAAD,CAApB,EAA+B;AAC7B,MAAA,KAAK,GAAG,OAAO,CAAC,MAAhB;AACD,KAFD,MAEO,IAAI,wBAAwB,CAAC,OAAD,CAAxB,IAAqC,sBAAsB,CAAC,OAAD,CAA/D,EAA0E;AAC/E,MAAA,KAAK,GAAG,YAAY,OAAO,CAAC,EAAE,EAA9B;AACD,KAFM,MAEA,IAAI,eAAe,CAAC,OAAD,CAAnB,EAA8B;AACnC,MAAA,KAAK,GAAG,OAAO,CAAC,KAAhB;AACD,KAFM,MAEA;AACL,MAAA,KAAK,GAAG,EAAR;AACD;;AAED,QAAI,KAAJ,EAAW;AACT,MAAA,aAAa,GAAG,KAAK,cAAL,CAAoB,MAApB,CACb,YAAD,IAAiC,YAAY,CAAC,KAAb,KAAuB,KAD1C,CAAhB;AAGD;;AAED,QACE,CAAC,CAAC,aAAD,IAAkB,CAAC,aAAa,CAAC,MAAlC,KACA,CAAC,eAAe,CAAC,KAAD,CADhB,IAEA,CAAC,eAAe,CAAC,KAAD,CAHlB,EAIE;AACA,MAAA,aAAa,GAAG,KAAK,cAAL,CAAoB,MAApB,CACb,YAAD,IAAiC,YAAY,CAAC,KAAb,KAAuB,cAD1C,CAAhB;AAGD;;AAED,IAAA,aAAa,CAAC,OAAd,CAAuB,YAAD,IAAgC;AACpD,UAAI,sBAAsB,CAAC,OAAD,CAA1B,EAAqC;AACnC,cAAM,KAAK,GAAG,IAAI,KAAJ,CAAU,OAAO,CAAC,KAAR,CAAc,OAAxB,CAAd;AACA,QAAA,YAAY,CAAC,QAAb,CAAsB,KAAtB,EAA6B,IAA7B;AACD,OAHD,MAGO;AACL,QAAA,YAAY,CAAC,QAAb,CAAsB,IAAtB,EAA4B,OAA5B;AACD;AACF,KAPD;AAQD;;AAvDe;;AA0DlB,eAAe,YAAf","sourceRoot":"","sourcesContent":["import { isJsonRpcRequest, isJsonRpcResponseSuccess, isJsonRpcResponseError, isInternalEvent, isReservedEvent, } from \"@walletconnect/utils\";\nclass EventManager {\n    constructor() {\n        this._eventEmitters = [];\n    }\n    subscribe(eventEmitter) {\n        this._eventEmitters.push(eventEmitter);\n    }\n    unsubscribe(event) {\n        this._eventEmitters = this._eventEmitters.filter(x => x.event !== event);\n    }\n    trigger(payload) {\n        let eventEmitters = [];\n        let event;\n        if (isJsonRpcRequest(payload)) {\n            event = payload.method;\n        }\n        else if (isJsonRpcResponseSuccess(payload) || isJsonRpcResponseError(payload)) {\n            event = `response:${payload.id}`;\n        }\n        else if (isInternalEvent(payload)) {\n            event = payload.event;\n        }\n        else {\n            event = \"\";\n        }\n        if (event) {\n            eventEmitters = this._eventEmitters.filter((eventEmitter) => eventEmitter.event === event);\n        }\n        if ((!eventEmitters || !eventEmitters.length) &&\n            !isReservedEvent(event) &&\n            !isInternalEvent(event)) {\n            eventEmitters = this._eventEmitters.filter((eventEmitter) => eventEmitter.event === \"call_request\");\n        }\n        eventEmitters.forEach((eventEmitter) => {\n            if (isJsonRpcResponseError(payload)) {\n                const error = new Error(payload.error.message);\n                eventEmitter.callback(error, null);\n            }\n            else {\n                eventEmitter.callback(null, payload);\n            }\n        });\n    }\n}\nexport default EventManager;\n//# sourceMappingURL=events.js.map"]},"metadata":{},"sourceType":"module"}